# GrpcClient Product Requirements Document

> **Version:** 1.0
> **Date:** 2024
> **Product:** GrpcClient - Modern gRPC command-line client in Rust

## Executive Summary

GrpcClient is a modern command-line tool for interacting with gRPC services, implemented in Rust for superior performance and reliability. It provides a clean, opinionated interface for testing, debugging, and exploring gRPC APIs with focus on common use cases rather than extreme flexibility.

## Core Value Proposition

- **Modern Rust implementation** with superior performance and memory safety
- **Opinionated design** focusing on common use cases over extreme flexibility
- **Clean CLI interface** for gRPC services using HTTP/2
- **Smart schema discovery** through gRPC reflection with proto file fallback
- **JSON-first approach** with optional text format support
- **Secure by default** with comprehensive TLS support

## Feature Categories

### 1. Service Discovery & Introspection

#### 1.1 Service Listing

**Feature:** List available gRPC services

```bash
grpc-client [options] [host:port] list
grpc-client [options] [host:port] list service.name
```

**Capabilities:**

- List all services exposed by a gRPC server
- List all methods within a specific service
- Support for both reflection-based and file-based discovery
- Sorted output for consistent results

#### 1.2 Service Description

**Feature:** Describe gRPC service definitions

```bash
grpcurl [options] [host:port] describe
grpcurl [options] [host:port] describe service.name
grpcurl [options] [host:port] describe service.name.method
```

**Capabilities:**

- Show detailed protocol buffer definitions
- Display message schemas, field types, and service methods
- Support for describing services, methods, messages, enums, and fields
- Optional message template generation with `-msg-template`
- Output format matches protobuf IDL syntax

### 2. RPC Invocation

#### 2.1 Method Invocation

**Feature:** Invoke gRPC methods with request data

```bash
grpcurl [options] [host:port] service.name/method.name
grpcurl -d '{"field": "value"}' [host:port] service.name.method.name
```

**Capabilities:**

- Support for all gRPC method types:
  - Unary RPC (single request → single response)
  - Server streaming (single request → multiple responses)
  - Client streaming (multiple requests → single response)
  - Bidirectional streaming (multiple requests ↔ multiple responses)
- Request data from command line (`-d`) or stdin (`-d @`)
- Empty message support for methods requiring no input

#### 2.2 Data Format Support

**Feature:** Multiple request/response data formats

**JSON Format (`-format json`):**

- Human-readable JSON input/output
- Automatic protobuf ↔ JSON conversion
- Support for `google.protobuf.Any` messages
- Base64 encoding for binary fields (ending in `-bin`)
- Optional emission of default values with `-emit-defaults`
- Unknown field handling with `-allow-unknown-fields`

**Text Format (`-format text`):**

- Protocol Buffer text format for input/output
- Record separator (0x1E) for multiple messages
- Compact and human-readable representation
- Direct protobuf text marshal/unmarshal

### 3. Schema Sources

#### 3.1 gRPC Reflection

**Feature:** Dynamic schema discovery using gRPC reflection API

```bash
grpcurl [host:port] list  # Uses reflection by default
grpcurl -use-reflection=false [options] ...  # Disable reflection
```

**Capabilities:**

- Automatic service/method discovery
- Real-time schema information
- No need for local proto files
- Reflection-specific headers with `-reflect-header`

#### 3.2 Protocol Buffer Files

**Feature:** Use local .proto source files

```bash
grpcurl -proto service.proto -import-path ./protos [host:port] service/method
```

**Capabilities:**

- Support for multiple proto files with `-proto`
- Import path resolution with `-import-path`
- Dependency resolution across multiple files
- Source code information preservation

#### 3.3 FileDescriptorSet Support

**Feature:** Use pre-compiled protobuf descriptor sets

```bash
grpcurl -protoset service.protoset [host:port] service/method
```

**Capabilities:**

- Multiple protoset files support
- Generated by `protoc --descriptor_set_out`
- Faster startup (no parsing required)
- Ideal for CI/CD and automated testing

#### 3.4 Composite Sources

**Feature:** Combine reflection with file-based sources

```bash
grpcurl -proto local.proto [host:port] service/method
```

**Capabilities:**

- Reflection + file sources combined automatically
- File sources take precedence over reflection
- Useful for local development with custom types

### 4. Connection & Security

#### 4.1 TLS/SSL Support

**Feature:** Comprehensive TLS configuration

```bash
grpcurl -cacert ca.pem -cert client.pem -key client.key [host:port] service/method
```

**Capabilities:**

- **Default TLS:** Enabled by default (disable with `-plaintext`)
- **Certificate validation:** Custom CA certificates with `-cacert`
- **Mutual TLS:** Client certificate authentication with `-cert`/`-key`
- **Insecure mode:** Skip certificate validation with `-insecure`
- **Server name override:** Custom server name with `-servername`
- **Authority override:** Custom authority with `-authority`
- **TLS key logging:** SSLKEYLOGFILE environment variable support

#### 4.2 ALTS (Application Layer Transport Security)

**Feature:** Google Cloud ALTS support for GCP environments

```bash
grpcurl -alts [host:port] service/method
grpcurl -alts -alts-target-service-account account@project.iam.gserviceaccount.com [host:port] service/method
```

**Capabilities:**

- ALTS authentication for Google Cloud Platform
- Service account targeting
- Custom handshaker service address
- Mutual authentication without certificates

#### 4.3 Connection Management

**Feature:** Advanced connection configuration

**Timeouts:**

- `-connect-timeout`: Connection establishment timeout
- `-max-time`: Total operation timeout
- `-keepalive-time`: Keepalive probe interval

**Connection Options:**

- `-max-msg-sz`: Maximum message size limit
- Custom dial options and transport credentials
- User agent customization with `-user-agent`

### 5. Headers & Metadata

#### 5.1 Request Headers

**Feature:** Custom gRPC metadata headers

```bash
grpcurl -H "authorization: Bearer token" -rpc-header "custom: value" [host:port] service/method
```

**Capabilities:**

- **Global headers (`-H`):** Sent with all requests including reflection
- **RPC headers (`-rpc-header`):** Only sent with method invocation
- **Reflection headers (`-reflect-header`):** Only sent with reflection requests
- **Binary headers:** Automatic base64 encoding for `-bin` suffixed headers
- **Environment expansion:** Variable substitution with `-expand-headers`

#### 5.2 Response Headers & Trailers

**Feature:** Display response metadata

```bash
grpcurl -v [host:port] service/method  # Show headers
grpcurl -vv [host:port] service/method # Show headers + timing
```

**Capabilities:**

- Response headers display in verbose mode
- Trailing metadata after RPC completion
- Status codes and error details
- Timing information in very verbose mode

### 6. Output & Formatting

#### 6.1 Verbosity Control

**Feature:** Configurable output detail levels

**Standard Output:**

- Response messages only
- Clean output suitable for piping
- Record separators between messages

**Verbose (`-v`):**

- Request/response headers
- Status information
- Request/response counts

**Very Verbose (`-vv`):**

- Timing data for each operation phase
- Detailed connection information
- Performance debugging data

#### 6.2 Error Handling

**Feature:** Comprehensive error reporting

```bash
grpcurl -format-error [host:port] service/method
```

**Capabilities:**

- gRPC status codes with descriptions
- Formatted error messages in JSON/text
- Exit codes offset by 64 to avoid conflicts
- Structured error details

#### 6.3 Output Generation

**Feature:** Generate protocol buffer artifacts

**Protoset Output (`-protoset-out`):**

- Generate FileDescriptorSet from used schemas
- Include transitive dependencies
- Binary format for programmatic use

**Proto File Output (`-proto-out-dir`):**

- Generate .proto source files
- Reconstructed from descriptors
- Human-readable format

### 7. Advanced Features

#### 7.1 Unix Domain Sockets

**Feature:** Local inter-process communication

```bash
grpcurl -unix /path/to/socket service/method
```

**Capabilities:**

- Unix domain socket support on Unix platforms
- Local service communication
- No network overhead

#### 7.2 Message Templates

**Feature:** Generate request templates for complex messages

```bash
grpcurl describe -msg-template [host:port] message.type
```

**Capabilities:**

- JSON templates with all fields
- Default value population
- Nested message structure examples
- Development and testing aid

#### 7.3 Streaming Support

**Feature:** Full streaming RPC support

**Client Streaming:**

- Multiple request messages
- Stream completion handling
- Input from stdin or command line

**Server Streaming:**

- Multiple response handling
- Real-time response display
- Stream termination detection

**Bidirectional Streaming:**

- Concurrent send/receive
- Full-duplex communication
- Complex interaction patterns

## Technical Requirements

### Performance

- **Startup time:** < 100ms for reflection-based discovery
- **Memory usage:** Minimal footprint for CLI tool
- **Streaming:** Support for large message streams
- **Concurrency:** Thread-safe for bidirectional streaming

### Compatibility

- **gRPC versions:** Compatible with gRPC 1.x protocol
- **Protobuf versions:** Support proto2 and proto3
- **Platforms:** Cross-platform (Linux, macOS, Windows, Unix variants)
- **Go version:** Modern Go runtime support

### Reliability

- **Error handling:** Graceful degradation on failures
- **Connection recovery:** Proper cleanup on interruption
- **Resource management:** No memory leaks in long-running operations
- **Signal handling:** Proper shutdown on SIGINT/SIGTERM

## Security Considerations

### TLS Security

- Strong cipher suite defaults
- Certificate validation enabled by default
- Support for modern TLS versions
- Key logging for debugging (opt-in)

### Authentication

- Bearer token support via headers
- Client certificate authentication
- ALTS for Google Cloud environments
- Custom authentication header support

### Data Protection

- Secure credential handling
- Environment variable expansion for secrets
- No credential logging in verbose mode
- Proper cleanup of sensitive data

## Use Cases

### Development & Testing

- Interactive API exploration
- Manual testing of gRPC services
- Request/response debugging
- Schema validation

### CI/CD Integration

- Automated API testing
- Health check scripts
- Deployment verification
- Integration test automation

### Production Operations

- Service monitoring
- Troubleshooting
- Performance testing
- Administrative operations

### Documentation & Discovery

- API documentation generation
- Service catalog maintenance
- Schema evolution tracking
- Developer onboarding

## Success Metrics

- **Adoption:** Wide usage in gRPC ecosystem
- **Reliability:** < 0.1% failure rate for valid requests
- **Performance:** Sub-second response times for typical operations
- **Usability:** Intuitive curl-like interface
- **Compatibility:** Works with all major gRPC implementations
